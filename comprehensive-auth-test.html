<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comprehensive Auth Test</title>
  </head>
  <body>
    <h1>Comprehensive Authentication Test</h1>
    <div id="results"></div>

    <script>
      const resultsDiv = document.getElementById("results");

      async function runTests() {
        resultsDiv.innerHTML = "<h2>Running Authentication Tests...</h2>";

        // Test 1: Basic fetch to Supabase
        try {
          resultsDiv.innerHTML += "<h3>Test 1: Basic Supabase Connection</h3>";
          const response = await fetch(
            "https://jclgmvbkrlkppecwnljv.supabase.co/auth/v1/health",
            {
              method: "GET",
              headers: {
                apikey:
                  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjbGdtdmJrcmxrcHBlY3dubGp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NTU5ODYsImV4cCI6MjA2ODUzMTk4Nn0.BQUBTydxPfOz17ZF-I3P3Xg5qwI9dcs6TDpJHKIhggg",
              },
            }
          );

          if (response.ok) {
            resultsDiv.innerHTML += "<p>✅ Basic connection successful</p>";
          } else {
            resultsDiv.innerHTML += `<p>❌ Basic connection failed: ${response.status}</p>`;
          }
        } catch (error) {
          resultsDiv.innerHTML += `<p>❌ Basic connection error: ${error.message}</p>`;
        }

        // Test 2: Try sign in with fetch
        try {
          resultsDiv.innerHTML += "<h3>Test 2: Direct Fetch Sign In</h3>";
          const signInResponse = await fetch(
            "https://jclgmvbkrlkppecwnljv.supabase.co/auth/v1/token?grant_type=password",
            {
              method: "POST",
              headers: {
                apikey:
                  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjbGdtdmJrcmxrcHBlY3dubGp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NTU5ODYsImV4cCI6MjA2ODUzMTk4Nn0.BQUBTydxPfOz17ZF-I3P3Xg5qwI9dcs6TDpJHKIhggg",
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                email: "test@example.com",
                password: "testpassword123",
              }),
            }
          );

          const signInData = await signInResponse.json();

          if (signInResponse.ok) {
            resultsDiv.innerHTML += "<p>✅ Direct fetch sign in successful</p>";
            resultsDiv.innerHTML += `<p>User ID: ${signInData.user?.id}</p>`;
          } else {
            resultsDiv.innerHTML += `<p>❌ Direct fetch sign in failed: ${
              signInData.error_description || signInData.msg
            }</p>`;
          }
        } catch (error) {
          resultsDiv.innerHTML += `<p>❌ Direct fetch sign in error: ${error.message}</p>`;
        }

        // Test 3: Check CORS
        try {
          resultsDiv.innerHTML += "<h3>Test 3: CORS Check</h3>";
          const corsResponse = await fetch(
            "https://jclgmvbkrlkppecwnljv.supabase.co/auth/v1/token",
            {
              method: "OPTIONS",
              headers: {
                Origin: "http://localhost:5173",
                "Access-Control-Request-Method": "POST",
                "Access-Control-Request-Headers": "apikey,content-type",
              },
            }
          );

          const corsHeaders = corsResponse.headers.get(
            "Access-Control-Allow-Origin"
          );
          resultsDiv.innerHTML += `<p>CORS Origin: ${corsHeaders}</p>`;

          if (corsHeaders === "*" || corsHeaders === "http://localhost:5173") {
            resultsDiv.innerHTML += "<p>✅ CORS configuration looks good</p>";
          } else {
            resultsDiv.innerHTML += "<p>❌ CORS might be blocking requests</p>";
          }
        } catch (error) {
          resultsDiv.innerHTML += `<p>❌ CORS check error: ${error.message}</p>`;
        }

        resultsDiv.innerHTML += "<h3>Summary</h3>";
        resultsDiv.innerHTML +=
          "<p>If all tests pass but React app still fails, the issue is likely:</p>";
        resultsDiv.innerHTML += "<ul>";
        resultsDiv.innerHTML +=
          "<li>Supabase client configuration in React</li>";
        resultsDiv.innerHTML += "<li>Browser security policies</li>";
        resultsDiv.innerHTML += "<li>Network/proxy issues</li>";
        resultsDiv.innerHTML += "</ul>";
      }

      runTests();
    </script>
  </body>
</html>
